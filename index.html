<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SatScope - ISS Tracker</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; text-align: center; }
    #map { height: 400px; width: 100%; }
    header { background: #222; color: white; padding: 10px; font-size: 1.5em; }
    button { padding: 10px 15px; margin: 10px; background: #007BFF; color: white; border: none; border-radius: 8px; cursor: pointer; }
    button:hover { background: #0056b3; }
  </style>
</head>
<body>
  <header>SatScope üåç - ISS Tracker</header>
  <div id="map"></div>
  <div>
    <h2 id="pass-timer">Loading next visible pass...</h2>
    <button onclick="getSatellitesAbove()">Show Satellites Above Me</button>
  </div>  <script>
    const API_KEY = "LY45T7-MPCWBG-YQ7Q5V-5KK8"; // Your provided N2YO key
    const ISS_ID = 25544; // NORAD ID for the ISS

    // Initialize map
    const map = L.map('map').setView([0, 0], 2);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 18,
    }).addTo(map);

    const issIcon = L.icon({
      iconUrl: 'https://upload.wikimedia.org/wikipedia/commons/d/d0/International_Space_Station.svg',
      iconSize: [50, 32],
    });

    const issMarker = L.marker([0, 0], { icon: issIcon }).addTo(map);

    // Fetch ISS position every 5 seconds
    async function fetchISSPosition() {
      try {
        const res = await fetch(`https://api.n2yo.com/rest/v1/satellite/positions/${ISS_ID}/0/0/0/1/?apiKey=${API_KEY}`);
        const data = await res.json();
        console.log("ISS Position Data:", data);

        if (data.positions && data.positions.length > 0) {
          const { satlatitude, satlongitude } = data.positions[0];
          issMarker.setLatLng([satlatitude, satlongitude]);
          map.setView([satlatitude, satlongitude], 3);
        }
      } catch (error) {
        console.error("Error fetching ISS position:", error);
      }
    }

    // Fetch satellites above user's location
    async function getSatellitesAbove() {
      if (!navigator.geolocation) {
        alert("Geolocation not supported by your browser");
        return;
      }

      navigator.geolocation.getCurrentPosition(async (pos) => {
        const { latitude, longitude } = pos.coords;
        console.log("User location:", latitude, longitude);

        try {
          const url = `https://api.n2yo.com/rest/v1/satellite/above/${latitude}/${longitude}/0/70/0/?apiKey=${API_KEY}`;
          console.log("Fetching:", url);

          const res = await fetch(url);
          const data = await res.json();
          console.log("Satellites Above Response:", data);

          if (data.above && data.above.length > 0) {
            const satelliteNames = data.above.map(s => s.satname).join(", ");
            alert(`Satellites overhead right now:\n${satelliteNames}`);
          } else {
            alert("No satellites overhead at the moment.");
          }
        } catch (error) {
          console.error("Error fetching satellites above:", error);
          alert("Error fetching satellites. Check console for details.");
        }
      }, (error) => {
        alert("Unable to access location. Please allow location permissions.");
        console.error("Geolocation error:", error);
      });
    }

    // Fetch next visible pass countdown
    async function fetchNextPass() {
      if (!navigator.geolocation) return;
      navigator.geolocation.getCurrentPosition(async (pos) => {
        const { latitude, longitude } = pos.coords;

        try {
          const res = await fetch(`https://api.n2yo.com/rest/v1/satellite/visualpasses/${ISS_ID}/${latitude}/${longitude}/0/1/300/?apiKey=${API_KEY}`);
          const data = await res.json();
          console.log("Next Pass Data:", data);

          if (data.passes && data.passes.length > 0) {
            const nextPass = new Date(data.passes[0].startUTC * 1000);
            setInterval(() => {
              const now = new Date();
              const diff = Math.max(0, (nextPass - now) / 1000);
              const minutes = Math.floor(diff / 60);
              const seconds = Math.floor(diff % 60);
              document.getElementById('pass-timer').innerText = `Next visible ISS pass in: ${minutes}m ${seconds}s`;
            }, 1000);
          } else {
            document.getElementById('pass-timer').innerText = "No visible passes in the next 24 hours.";
          }
        } catch (error) {
          console.error("Error fetching next pass:", error);
        }
      });
    }

    // Start updates
    fetchISSPosition();
    setInterval(fetchISSPosition, 5000);
    fetchNextPass();
  </script></body>
</html>
